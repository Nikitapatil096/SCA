import uuid
from strobes.app.models import *
from strobes.connectors.serializers import CreateScannerConfigSerializer
from strobes.connectors.utils.misc.github import get_all_repos

repos_from_text_file = ['https://github.com/ZEE-5/ZEE5-Android.git', 'https://github.com/ZEE-5/ZEE5-iOS.git', 'https://github.com/ZEE-5/ZEE5-Crossplatform.git', 'https://github.com/ZEE-5/ZEE5-Prime.git', 'https://github.com/ZEE-5/android-living-room.git', 'https://github.com/ZEE-5/binary-pods-cache.git', 'https://github.com/ZEE-5/roku.git', 'https://github.com/ZEE-5/AppleTV.git', 'https://github.com/ZEE-5/pwa.git', 'https://github.com/ZEE-5/hipi-web-notused.git', 'https://github.com/ZEE-5/release-management-scripts.git', 'https://github.com/ZEE-5/Nagra-QuickMarkView.git', 'https://github.com/ZEE-5/ZPlayer-Android.git', 'https://github.com/ZEE-5/living-room-file-storage.git', 'https://github.com/ZEE-5/pipeline-hipi.git', 'https://github.com/ZEE-5/IOS_IS_ZACA.git', 'https://github.com/ZEE-5/appletv_v2.git', 'https://github.com/ZEE-5/smart-tv-web-app.git', 'https://github.com/ZEE-5/zee5-k8s-poc.git', 'https://github.com/ZEE-5/roku_v2.git', 'https://github.com/ZEE-5/analytics-json-schemas.git', 'https://github.com/ZEE-5/pipeline-zee5-profiles.git', 'https://github.com/ZEE-5/zee5-profiles.git', 'https://github.com/ZEE-5/old-zee5-gwapi-content.git', 'https://github.com/ZEE-5/roku-living-room.git', 'https://github.com/ZEE-5/ios-certificates.git', 'https://github.com/ZEE-5/helm-chart-dev.git', 'https://github.com/ZEE-5/argo-terraform-dev.git', 'https://github.com/ZEE-5/Zee5-pwa-app.git', 'https://github.com/ZEE-5/zee5-ios-automation.git', 'https://github.com/ZEE-5/zee5-dev-env-old.git', 'https://github.com/ZEE-5/ZEE5_Automation.git', 'https://github.com/ZEE-5/zee5-solr-collections-fastify.git', 'https://github.com/ZEE-5/zee5-solr-indexer.git', 'https://github.com/ZEE-5/subscriptionapi-new.git', 'https://github.com/ZEE-5/google-seo.git', 'https://github.com/ZEE-5/zee5dashboard.git', 'https://github.com/ZEE-5/solr-to-elastic-search.git', 'https://github.com/ZEE-5/zee5-gwapi-content.git', 'https://github.com/ZEE-5/mw-cdn-service.git', 'https://github.com/ZEE-5/mw-dataprocess-service.git', 'https://github.com/ZEE-5/mw-common-service.git', 'https://github.com/ZEE-5/mw-imageprocess-service.git', 'https://github.com/ZEE-5/mw-oldindexer-service.git', 'https://github.com/ZEE-5/mw-preindexer-service.git', 'https://github.com/ZEE-5/mw-filterindexer-service.git', 'https://github.com/ZEE-5/zee5-watchhistory-lambda.git', 'https://github.com/ZEE-5/mw-indexer-service.git', 'https://github.com/ZEE-5/mw-notification-service.git', 'https://github.com/ZEE-5/zee5-cwnext-cron.git', 'https://github.com/ZEE-5/zee5_music_backend.git', 'https://github.com/ZEE-5/collections_filter_solr_indexer.git', 'https://github.com/ZEE-5/collections_filter_solr_update_delete_sns_lambda_handler.git', 'https://github.com/ZEE-5/collections_filter_solr_update_delete_akamai_purge_lambda.git', 'https://github.com/ZEE-5/zee5-algolia-synch.git', 'https://github.com/ZEE-5/zee5-new-middleware.git', 'https://github.com/ZEE-5/zee5-phalcon.git', 'https://github.com/ZEE-5/zee5-userchoice-api.git', 'https://github.com/ZEE-5/jio-vue.git', 'https://github.com/ZEE-5/zee5in-vertical-video.git', 'https://github.com/ZEE-5/vertical-video.git', 'https://github.com/ZEE-5/zee5-artemis-service.git', 'https://github.com/ZEE-5/net_storage_sync.git', 'https://github.com/ZEE-5/zee5-gwapi.git', 'https://github.com/ZEE-5/axinom-ingestion.git', 'https://github.com/ZEE-5/beforetv-repo.git', 'https://github.com/ZEE-5/pipeline-zee5-music-backend.git', 'https://github.com/ZEE-5/self-serve.git', 'https://github.com/ZEE-5/zee5-adtech-crs.git', 'https://github.com/ZEE-5/zee5-reco-metadata-api.git', 'https://github.com/ZEE-5/zee5-adtech-rs.git', 'https://github.com/ZEE-5/zee5-adtech-dp.git', 'https://github.com/ZEE-5/zee5-adtech-caps.git', 'https://github.com/ZEE-5/zee5-adtech-config.git', 'https://github.com/ZEE-5/zee5-adtech-aco.git', 'https://github.com/ZEE-5/zee5-adtech-cc.git', 'https://github.com/ZEE-5/zee5-adtech-jdc.git', 'https://github.com/ZEE-5/zee5-adtech-event-handler.git', 'https://github.com/ZEE-5/zee5-adtech-gender_prediction.git', 'https://github.com/ZEE-5/recommendation-api.git', 'https://github.com/ZEE-5/zee5-xroad-sync.git', 'https://github.com/ZEE-5/selfserve-data-processor.git', 'https://github.com/ZEE-5/adserver2-ui.git', 'https://github.com/ZEE-5/adserver2.git', 'https://github.com/ZEE-5/adserver2-kaltura-plugin.git', 'https://github.com/ZEE-5/adserver2-management.git', 'https://github.com/ZEE-5/adserver2-infrastructure.git', 'https://github.com/ZEE-5/adserver2-documentation.git', 'https://github.com/ZEE-5/adserver2-docker-images.git', 'https://github.com/ZEE-5/adserver2-tracker.git', 'https://github.com/ZEE-5/adserver2-foundations.git', 'https://github.com/ZEE-5/adserver2-sdk-e2e-tests.git', 'https://github.com/ZEE-5/adserver2-js-sdk-infrastructure.git', 'https://github.com/ZEE-5/adserver2-logstreams.git', 'https://github.com/ZEE-5/adserver2-js-sdk.git', 'https://github.com/ZEE-5/z5x-terraform-aws-modules.git', 'https://github.com/ZEE-5/pipeline-mw-imageprocess-service.git', 'https://github.com/ZEE-5/pipeline-mw-cdn-service.git', 'https://github.com/ZEE-5/pipeline-mw-common-service.git', 'https://github.com/ZEE-5/pipeline-mw-oldindexer-service.git', 'https://github.com/ZEE-5/pipeline-mw-filterindexer-service.git', 'https://github.com/ZEE-5/pipeline-mw-indexer-service.git', 'https://github.com/ZEE-5/pipeline-mw-notification-service.git', 'https://github.com/ZEE-5/pipeline-mw-preindexer-service.git', 'https://github.com/ZEE-5/pipeline-solr-collections-fatisfy.git', 'https://github.com/ZEE-5/zee5-optimove-channels.git', 'https://github.com/ZEE-5/zee5-optimove-campaign-service.git', 'https://github.com/ZEE-5/zee5-news-notification.git', 'https://github.com/ZEE-5/zee5-whatsapp.git', 'https://github.com/ZEE-5/api-platform.git', 'https://github.com/ZEE-5/zee5-optimove-dailydata.git', 'https://github.com/ZEE-5/zee5-gwapi-vertx.git', 'https://github.com/ZEE-5/zee5-gwapi-liquibase.git', 'https://github.com/ZEE-5/zee5-gwapi-configs.git', 'https://github.com/ZEE-5/zee5-launch-api-vertx.git', 'https://github.com/ZEE-5/zee5-launch-api-lambda.git', 'https://github.com/ZEE-5/zee5-singleplayback-api.git', 'https://github.com/ZEE-5/zee5-entitlement-vertx.git', 'https://github.com/ZEE-5/zee5-pwa.git', 'https://github.com/ZEE-5/zee5-kaltura-web-player.git', 'https://github.com/ZEE-5/web-player.git', 'https://github.com/ZEE-5/zee5-benchmarking.git', 'https://github.com/ZEE-5/vertx_starter_framework.git', 'https://github.com/ZEE-5/zee5-pwa-devtest.git', 'https://github.com/ZEE-5/pipeline-subscription.git', 'https://github.com/ZEE-5/https-github.com-ZEE-5-zee5-whatsapp.git', 'https://github.com/ZEE-5/https-github.com-ZEE-5-zee5whatsapp.git', 'https://github.com/ZEE-5/purchase-order-engine.git', 'https://github.com/ZEE-5/zee5-order.git', 'https://github.com/ZEE-5/zee5-order-bff.git', 'https://github.com/ZEE-5/pack-entitlement.git', 'https://github.com/ZEE-5/consumer-orchestrator.git', 'https://github.com/ZEE-5/device.git', 'https://github.com/ZEE-5/device-management.git', 'https://github.com/ZEE-5/enigma-service.git', 'https://github.com/ZEE-5/zee5whatsapp.git', 'https://github.com/ZEE-5/raven.git', 'https://github.com/ZEE-5/themis.git', 'https://github.com/ZEE-5/turbine.git', 'https://github.com/ZEE-5/transformer.git', 'https://github.com/ZEE-5/propay.git', 'https://github.com/ZEE-5/payment.git', 'https://github.com/ZEE-5/zee5-common-utilities.git', 'https://github.com/ZEE-5/zee5-watchhistory-api.git', 'https://github.com/ZEE-5/android-test-repo.git', 'https://github.com/ZEE-5/zee5-udp.git', 'https://github.com/ZEE-5/zee5-global.git', 'https://github.com/ZEE-5/zee5-useraction.git', 'https://github.com/ZEE-5/zee5-launch-api.git', 'https://github.com/ZEE-5/z5-b2b-partner.git', 'https://github.com/ZEE-5/b2b-global-telkomsel.git', 'https://github.com/ZEE-5/zee5-b2bapi.git', 'https://github.com/ZEE-5/zee5-partnerint-api.git', 'https://github.com/ZEE-5/pipeline-gwapi-content.git', 'https://github.com/ZEE-5/zee5-countryapi.git', 'https://github.com/ZEE-5/PaymentIntern.git', 'https://github.com/ZEE-5/backend-automation.git', 'https://github.com/ZEE-5/zee5-user-auth.git', 'https://github.com/ZEE-5/zee5-cobo.git', 'https://github.com/ZEE-5/zee5-voiro.git', 'https://github.com/ZEE-5/subscription.axinom-notused.git', 'https://github.com/ZEE-5/ms.common.axinom-notused.git', 'https://github.com/ZEE-5/user.axinom-notused.git', 'https://github.com/ZEE-5/pipeline-userchoice-api.git', 'https://github.com/ZEE-5/pipeline-gwapi.git', 'https://github.com/ZEE-5/zee5-qc-env.git', 'https://github.com/ZEE-5/pipeline-b2bapi.git', 'https://github.com/ZEE-5/pipeline-cpapi.git', 'https://github.com/ZEE-5/pipeline-zee5-watchhistory-lambda.git', 'https://github.com/ZEE-5/pipeline-zee5-whatsapp.git', 'https://github.com/ZEE-5/pipeline-gwapi-vertx.git', 'https://github.com/ZEE-5/pipeline-launch-api-vertx.git', 'https://github.com/ZEE-5/pipeline-zee5-launch-api-lambda.git', 'https://github.com/ZEE-5/pipeline-entitlement-vertx.git', 'https://github.com/ZEE-5/pipeline-purchase-order-engine.git', 'https://github.com/ZEE-5/pipeline-zee5-order.git', 'https://github.com/ZEE-5/zee5-algolia-sync-singleindex.git', 'https://github.com/ZEE-5/artemis-service.git', 'https://github.com/ZEE-5/pipeline-country.git', 'https://github.com/ZEE-5/pipeline-propay-2.git', 'https://github.com/ZEE-5/pipeline-turbine.git', 'https://github.com/ZEE-5/pipeline-themis.git', 'https://github.com/ZEE-5/pipeline-zee5-order-bff.git', 'https://github.com/ZEE-5/zee5-data-pipelines.git', 'https://github.com/ZEE-5/pipeline-pack-entitlement.git', 'https://github.com/ZEE-5/pipeline-consumer-orchestrator.git', 'https://github.com/ZEE-5/pipeline-raven.git', 'https://github.com/ZEE-5/pipeline-device.git', 'https://github.com/ZEE-5/pipeline-pm-device-management.git', 'https://github.com/ZEE-5/z5front-end-web.git', 'https://github.com/ZEE-5/subscription-management-service.git', 'https://github.com/ZEE-5/pipeline-launch-api.git', 'https://github.com/ZEE-5/pipeline-b2b-partner.git', 'https://github.com/ZEE-5/pipeline-b2b-global-telkomsel.git', 'https://github.com/ZEE-5/nft-api.git', 'https://github.com/ZEE-5/nft-app.git', 'https://github.com/ZEE-5/nft-smart-contract.git', 'https://github.com/ZEE-5/zee5-appium-automation.git', 'https://github.com/ZEE-5/db-migration-tool.git', 'https://github.com/ZEE-5/zee5-launch-api-data-migration.git', 'https://github.com/ZEE-5/pipeline-partnerint.git', 'https://github.com/ZEE-5/pipeline-uapi.git', 'https://github.com/ZEE-5/pipeline-zee5-user-auth.git', 'https://github.com/ZEE-5/zee5-payment-api.git', 'https://github.com/ZEE-5/payment-platform.git', 'https://github.com/ZEE-5/zee5-notifications-engine.git', 'https://github.com/ZEE-5/pipeline-optimove-channels.git', 'https://github.com/ZEE-5/pwa-minimal-cluster.git', 'https://github.com/ZEE-5/pipeline-launch-api-data-migration.git', 'https://github.com/ZEE-5/whapinode.git', 'https://github.com/ZEE-5/whapi.git', 'https://github.com/ZEE-5/Zee5_HWA_Automation.git', 'https://github.com/ZEE-5/pipeline-global-help-center.git', 'https://github.com/ZEE-5/zee5-clm-portal.git', 'https://github.com/ZEE-5/pipeline-paycms.git', 'https://github.com/ZEE-5/pipeline-secure-payments.git', 'https://github.com/ZEE-5/pipeline-zee5-cobo.git', 'https://github.com/ZEE-5/zee5-global-help-center.git', 'https://github.com/ZEE-5/uapi-sequence-diagrams.git', 'https://github.com/ZEE-5/pipeline-transformer.git', 'https://github.com/ZEE-5/pipeline-payment.git', 'https://github.com/ZEE-5/pipeline-propay.git', 'https://github.com/ZEE-5/subscription-via-ingestion.git', 'https://github.com/ZEE-5/zee5-lr-automation.git', 'https://github.com/ZEE-5/DevSecOpsTest-Webgoat.git', 'https://github.com/ZEE-5/zee5-pt-env.git', 'https://github.com/ZEE-5/pipeline-aws-service-development.git', 'https://github.com/ZEE-5/pipeline-device-management.git', 'https://github.com/ZEE-5/pipeline-whapi-node.git', 'https://github.com/ZEE-5/apidocumentaion.git', 'https://github.com/ZEE-5/mw-content-dashboard-service.git', 'https://github.com/ZEE-5/zee5-production-env.git', 'https://github.com/ZEE-5/mw-beforetv-scheduler-service.git', 'https://github.com/ZEE-5/newrelic-java.git', 'https://github.com/ZEE-5/communication-engine.git', 'https://github.com/ZEE-5/communication-rule-engine.git', 'https://github.com/ZEE-5/communication-template-engine.git', 'https://github.com/ZEE-5/communication-openapi-specs.git', 'https://github.com/ZEE-5/pipeline-zee5-watchhistory-api.git', 'https://github.com/ZEE-5/pipeline-smart-tv-web-app.git', 'https://github.com/ZEE-5/pipeline-zee5-artemis-service.git', 'https://github.com/ZEE-5/Data-Spring.git', 'https://github.com/ZEE-5/pipeline-gapi.git', 'https://github.com/ZEE-5/pipeline-zee5-adtech-crs-notused.git', 'https://github.com/ZEE-5/amazon-catalog-integration.git', 'https://github.com/ZEE-5/pipeline-mw-dataprocess.git', 'https://github.com/ZEE-5/chromecast-receiverv2.git', 'https://github.com/ZEE-5/pipeline-zee5-webapp.git', 'https://github.com/ZEE-5/pipeline-subscription-management-service.git', 'https://github.com/ZEE-5/pipeline-subscription-via-ingestion.git', 'https://github.com/ZEE-5/zee5-uapi-node.git', 'https://github.com/ZEE-5/zee5-userapi-node.git', 'https://github.com/ZEE-5/Zee-DE.git', 'https://github.com/ZEE-5/pipeline-zee5-adtech-dp-notused.git', 'https://github.com/ZEE-5/pipeline-zee5-adtech-cc-notused.git', 'https://github.com/ZEE-5/pipeline-mw-content-dashboard-service.git', 'https://github.com/ZEE-5/Backend_RestAutomation.git', 'https://github.com/ZEE-5/pipeline-mw-beforetv-scheduler-service.git', 'https://github.com/ZEE-5/b2b-partner-onboarding.git', 'https://github.com/ZEE-5/Zee5_AdTech_Reco_AIML.git', 'https://github.com/ZEE-5/clockwork-scheduler.git', 'https://github.com/ZEE-5/subscription-renewal-service.git', 'https://github.com/ZEE-5/pipeline-recoapi.git', 'https://github.com/ZEE-5/pipeline-zee5-reco-metadata-api.git', 'https://github.com/ZEE-5/pipeline-b2b-partner-onboarding.git', 'https://github.com/ZEE-5/pipeline-zee5-adtech-caps-notused.git', 'https://github.com/ZEE-5/merchandiser-user-service.git', 'https://github.com/ZEE-5/pipeline-amazon-catalog-integration.git', 'https://github.com/ZEE-5/pipeline-zee5-sensara.git', 'https://github.com/ZEE-5/zee5-playbacklicense-api.git', 'https://github.com/ZEE-5/communication-email-service.git', 'https://github.com/ZEE-5/communication-sms-service.git', 'https://github.com/ZEE-5/zee5-translations.git', 'https://github.com/ZEE-5/zee5-all-lambda.git', 'https://github.com/ZEE-5/pipeline-zee5-all-lambda.git', 'https://github.com/ZEE-5/zee5-bento4.git', 'https://github.com/ZEE-5/zee5-bitmovin.git', 'https://github.com/ZEE-5/zee5-ama-frontend.git', 'https://github.com/ZEE-5/zee5-ama-service.git', 'https://github.com/ZEE-5/zee5-ve-stage-env.git', 'https://github.com/ZEE-5/adtech-config.git', 'https://github.com/ZEE-5/zee5-user-app-crm.git', 'https://github.com/ZEE-5/zee5-bifrost.git', 'https://github.com/ZEE-5/zee5-b2b-frontend.git', 'https://github.com/ZEE-5/pipeline-adtech-spapi-adserver.git', 'https://github.com/ZEE-5/zee5-adtech-pocs.git', 'https://github.com/ZEE-5/zee5-ory-poc.git', 'https://github.com/ZEE-5/zee5-auth-bass.git', 'https://github.com/ZEE-5/pipeline-zee5-Bcrypt-api.git', 'https://github.com/ZEE-5/cs-self-help-service.git', 'https://github.com/ZEE-5/cs-case-service.git', 'https://github.com/ZEE-5/cs-crm-ticket-service.git', 'https://github.com/ZEE-5/cs-crm-customer-service.git', 'https://github.com/ZEE-5/pipeline-b2b-adminpanel.git', 'https://github.com/ZEE-5/pipeline-useraction.git', 'https://github.com/ZEE-5/zee5-help-center.git', 'https://github.com/ZEE-5/zee5-watch-history-mongodb-ksql-migration.git']

def get_repos_from_github(credential_id):
    list_of_repos = []
    if cm := CredentialManager.objects.filter(id=credential_id).first():
        list_of_repos = get_all_repos(access_token=cm.extra.get("access_token", ""))
        list_of_repos = [l["url"] for l in list_of_repos]
    return list_of_repos

class Request():
    user = User.objects.first()


def create_config(repo_url:str, org_id:str, connector_slug:str, credential_id:int, agent_id:int):
	if connector_slug == "github_dependabot" and GithubDependabotConfig.objects.filter(repo=repo_url, config__organization_id=org_id).exists():
		return
	if connector_slug == "codeql" and CodeQlConfig.objects.filter(owner_repo=repo_url, config__organization_id=org_id).exists():
		return
    request = Request()
    context = {"organizationId":org_id, "slug":connector_slug, "request":request}
    try:
        data = {
            "name": f"{connector_slug} {repo_url.split('/')[-1]}",
            "config_data": {
                "baseline": 1,
                "jira_tracker_configs": [],
                "bugzilla_tracker_configs": [],
                "slack_notifier_configs": [],
                "smtp_notifier_configs": [],
                "flock_notifier_configs": [],
                "microsoft_teams_notifier_configs": [],
                "tracking_rules_data": {
                    "search_qs_list": [],
                    "overwrite_existing_issues": False,
                    "log_groupped_issues": False,
                    "custom_title": "",
                    "custom_state": None,
                    "custom_severity": None,
                    "group_by": None
                },
                "scheduled_interval": 24,
                "tags": [],
                "credential_manager": credential_id,
                "owner_repo": repo_url
            },
            "auto_close_vulnerabilities": True,
            "agent_id": agent_id
        }
        if connector_slug == "github_dependabot":
            data["config_data"]["repo"] = repo_url
            del data["config_data"]["owner_repo"]
        serialized_data = CreateScannerConfigSerializer(data=data, context=context)
        serialized_data.is_valid(raise_exception=True)
        serialized_data.save()
    except:
        return
  


ORGANIZARION_ID = uuid.UUID("xxxxxxxxx")
CREDENTIAL_MANAGER_ID = 2
AGENT_ID=1

repos_from_github = get_repos_from_github(CREDENTIAL_MANAGER_ID)
repos_list = set(repos_from_github).intersection(repos_from_text_file)

for r in repos_list:
    create_config(r, ORGANIZARION_ID, "github_dependabot", CREDENTIAL_MANAGER_ID, AGENT_ID)
for r in repos_list:
    create_config(r, ORGANIZARION_ID, "codeql", CREDENTIAL_MANAGER_ID, AGENT_ID)
